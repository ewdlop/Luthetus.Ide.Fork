<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="en-US">
  <compounddef id="interface_luthetus_1_1_text_editor_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_i_text_editor_work" kind="interface" language="C#" prot="public">
    <compoundname>Luthetus::TextEditor::RazorLib::BackgroundTasks::Models::ITextEditorWork</compoundname>
    <basecompoundref refid="interface_luthetus_1_1_common_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_i_background_task" prot="public" virt="non-virtual">Luthetus.Common.RazorLib.BackgroundTasks.Models.IBackgroundTask</basecompoundref>
    <derivedcompoundref refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_redundant_text_editor_work" prot="public" virt="non-virtual">Luthetus.TextEditor.RazorLib.BackgroundTasks.Models.RedundantTextEditorWork</derivedcompoundref>
    <derivedcompoundref refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_unique_text_editor_work" prot="public" virt="non-virtual">Luthetus.TextEditor.RazorLib.BackgroundTasks.Models.UniqueTextEditorWork</derivedcompoundref>
    <derivedcompoundref refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_double_click" prot="public" virt="non-virtual">Luthetus.TextEditor.RazorLib.Events.Models.OnDoubleClick</derivedcompoundref>
    <derivedcompoundref refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_key_down_late_batching" prot="public" virt="non-virtual">Luthetus.TextEditor.RazorLib.Events.Models.OnKeyDownLateBatching</derivedcompoundref>
    <derivedcompoundref refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_mouse_down" prot="public" virt="non-virtual">Luthetus.TextEditor.RazorLib.Events.Models.OnMouseDown</derivedcompoundref>
    <derivedcompoundref refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_mouse_move" prot="public" virt="non-virtual">Luthetus.TextEditor.RazorLib.Events.Models.OnMouseMove</derivedcompoundref>
    <derivedcompoundref refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_scroll_horizontal" prot="public" virt="non-virtual">Luthetus.TextEditor.RazorLib.Events.Models.OnScrollHorizontal</derivedcompoundref>
    <derivedcompoundref refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_scroll_vertical" prot="public" virt="non-virtual">Luthetus.TextEditor.RazorLib.Events.Models.OnScrollVertical</derivedcompoundref>
    <derivedcompoundref refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_wheel" prot="public" virt="non-virtual">Luthetus.TextEditor.RazorLib.Events.Models.OnWheel</derivedcompoundref>
    <derivedcompoundref refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_wheel_batch" prot="public" virt="non-virtual">Luthetus.TextEditor.RazorLib.Events.Models.OnWheelBatch</derivedcompoundref>
    <sectiondef kind="property">
      <memberdef kind="property" id="interface_luthetus_1_1_text_editor_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_i_text_editor_work_1a4cdd759a4930bd6066a84a86cac60450" prot="public" static="no" readable="no" writable="no" gettable="yes" privategettable="no" protectedgettable="no" settable="yes" privatesettable="no" protectedsettable="no">
        <type><ref refid="interface_luthetus_1_1_text_editor_1_1_razor_lib_1_1_text_editors_1_1_models_1_1_i_text_editor_edit_context" kindref="compound">ITextEditorEditContext</ref></type>
        <definition>ITextEditorEditContext Luthetus.TextEditor.RazorLib.BackgroundTasks.Models.ITextEditorWork.EditContext</definition>
        <argsstring></argsstring>
        <name>EditContext</name>
        <qualifiedname>Luthetus.TextEditor.RazorLib.BackgroundTasks.Models.ITextEditorWork.EditContext</qualifiedname>
        <reimplementedby refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_redundant_text_editor_work_1ac8f218841f0c867d5519217354bd1812">EditContext</reimplementedby>
        <reimplementedby refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_unique_text_editor_work_1a37fd05e3dc3baef7bc91b61036153344">EditContext</reimplementedby>
        <reimplementedby refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_double_click_1ac9094d06da1d1609d8287be264a83bfd">EditContext</reimplementedby>
        <reimplementedby refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_key_down_late_batching_1a34419b652b68221a32f351b26584b260">EditContext</reimplementedby>
        <reimplementedby refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_mouse_down_1a429a8f7acbd2803b1dd54df7131efb85">EditContext</reimplementedby>
        <reimplementedby refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_mouse_move_1ad7ab67db003b9f3b21e75ea528925263">EditContext</reimplementedby>
        <reimplementedby refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_scroll_horizontal_1a5a6a01a54ef55ef37a94bcb0c3afa015">EditContext</reimplementedby>
        <reimplementedby refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_scroll_vertical_1a085b3addda8ca2a845d6a6224e0b9482">EditContext</reimplementedby>
        <reimplementedby refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_wheel_1a75f34b3d6dec1d78ebd6290e11461403">EditContext</reimplementedby>
        <reimplementedby refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_wheel_batch_1a046ce85d2e1029ce280e757fae4c1068">EditContext</reimplementedby>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Source/Lib/TextEditor/BackgroundTasks/Models/ITextEditorWork.cs" line="163" column="31" bodyfile="Source/Lib/TextEditor/BackgroundTasks/Models/ITextEditorWork.cs" bodystart="163" bodyend="163"/>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<sect1 id="interface_luthetus_1_1_text_editor_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_i_text_editor_work_1autotoc_md266">
<title>On the topic of &quot;generic batching&quot;:</title><para>I am leaving this comment here as a reminder to myself, of what I did to try and achieve &quot;generic batching&quot;, but the massive flaws that existed as a result. The goal being, if I ever revisit this topic, I don&apos;t just repeat the same mistake.</para>
<para>Every <ref refid="interface_luthetus_1_1_text_editor_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_i_text_editor_work" kindref="compound">ITextEditorWork</ref> when finished executing, will cause the text editor to render.</para>
<para>So, I started writing code to permit batching of <ref refid="interface_luthetus_1_1_text_editor_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_i_text_editor_work" kindref="compound">ITextEditorWork</ref>, in order to reduce the amount of rendering.</para>
<para>I started by having specific implementations of <ref refid="interface_luthetus_1_1_text_editor_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_i_text_editor_work" kindref="compound">ITextEditorWork</ref> be batchable amongst themselves.</para>
<para>For example, if the user types into the text editor, this results in the construction of a <ref refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_key_down_late_batching" kindref="compound">Events.Models.OnKeyDownLateBatching</ref>.</para>
<para>Therefore, upon enqueueing an instance of <ref refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_key_down_late_batching" kindref="compound">Events.Models.OnKeyDownLateBatching</ref>, it is found that the background task queue has in it a <ref refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_key_down_late_batching" kindref="compound">Events.Models.OnKeyDownLateBatching</ref>, which came immediately prior (they are contiguous), then combine them into a single <ref refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_key_down_late_batching" kindref="compound">Events.Models.OnKeyDownLateBatching</ref>.</para>
<para>A more concrete example would be a user typing the letter &apos;q&apos;, then the letter &apos;w&apos;.</para>
<para>Instead of: Insert(&quot;q&quot;); Render(); Insert(&quot;w&quot;); Render();</para>
<para>It might be preferable to: Insert(&quot;qw&quot;); Render();</para>
<para><ref refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_key_down_late_batching" kindref="compound">Events.Models.OnKeyDownLateBatching</ref> seems useful, but it seems to have an issue.</para>
<para>Take the example of a user HOLDING down the letter &apos;q&apos;. Sometimes the enqueueing and dequeueing seem to only batch, and never get handled.</para>
<para>Then once the user lets go, its discovered that &apos;q&apos; was batched 100 times (or however many times the keyboard event occurred while being held).</para>
<para>I suppose I&apos;m looking for it to batch, but eventually just handle the event, and start the batch over again with the next event. Instead of eternally batching under high load.</para>
<para>After I made an implementation of <ref refid="interface_luthetus_1_1_text_editor_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_i_text_editor_work" kindref="compound">ITextEditorWork</ref> for each of the UI events, I thought I would create an implementation for general use.</para>
<para>So that any task could batch, but instead of the batch optimizing the work (i.e.: 1 insert containing 2 characters instead of 2 inserts with each having 1 character) the batching was just a &apos;foreach&apos; loop, in order to avoid the render of the text editor.</para>
<para>So instead of: Insert(&quot;q&quot;); Render(); Insert(&quot;w&quot;); Render();</para>
<para>Do: Insert(&quot;q&quot;); Insert(&quot;w&quot;); Render();</para>
<para>But, this created an issue relating to when an exception was thrown, by one of the tasks that were put into that foreach loop.</para>
<para>If one threw an exception, then any following tasks would not run.</para>
<para>Okay fine, I can put a &apos;try-catch&apos; inside the &apos;foreach&apos; loop, around every invocation of an individual task.</para>
<para>But, the text editor is immutable. And in order to edit the text editor, one is given a edit context.</para>
<para>In short the edit context is the exact same data as the immutable version, except it is allowed to be changed. That is, the immutable data gets copied into a mutable version of itself.</para>
<para>Well, if an individual task threw an exception during the &apos;foreach-batching&apos;, is no longer as issue because of the &apos;try-catch&apos;?</para>
<para>The outcome was that, the individual task likely was unable to make the edit, that it sought out to make.</para>
<para>Maybe the task made part of their edit, prior to the exception.</para>
<para>Well, the metadata of the text editor (i.e.: position indices of the line endings, and etc...) is calculated separately to that of the insertion of text.</para>
<para>So, the insertion of a &apos;<linebreak/>
&apos; character, actually calculates the new line ending positions presuming it will be added without error, then lastly inserts the character.</para>
<para>If an exception occurs after calculating the metadata, but before inserting the character, then the text editor will enter a &quot;corrupt&quot;/&quot;unrecoverable&quot; state.</para>
<para>And yet, if we were to have batched that task which threw an exception, with other tasks following it. We go on to pass along the corrupt text editor state to the tasks that follow.</para>
<para>So, generic batching can only be done with one further step. Somehow, if a task throws an exception, the edit context needs to be reset to the state it was in prior to the invocation of that task.</para>
<para>This is a pain because it was previously mentioned that the text editor, after a batched task throws an exception, is likely in a &quot;corrupt&quot;/&quot;unrecoverable&quot; state.</para>
<para>It seems the only way is to create a new edit context, foreach of the tasks that are being batched.</para>
<para>This way, if a task throws an exception, then the edit context it was given can be discarded. Otherwise, take its edit context as the new edit context.</para>
<para>And if there is is a task following, then copy over the edit context and repeat until all the tasks have ran.</para>
<para>Then, write out the edit context that survives the ordeal and render.</para>
<para>This way of foreach batching is essentially the same as my mistake, but with the recreating of the edit context every time a task is ran. So one can &quot;rollback&quot; if a &quot;transaction&quot; does not successfully complete.</para>
<para>But, I wonder if this batching I just described, even if it worked, would it even be worthwhile?</para>
<para>That is, am I looking at batching too much, when I really need to be optimizing the <ref refid="interface_luthetus_1_1_common_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_i_background_task" kindref="compound">IBackgroundTask</ref>, such to remove the need to batch so much.</para>
<para>Something I think of a lot, is how I wrote the throttling code. I used an &apos;await Task.Delay(...)&apos;.</para>
<para>But in my mind, from a human perspective, starting a stopwatch, then stopping it at the 60 millisecond mark, over and over and over... this sounds like immense overhead.</para>
<para>I mention &quot;from a human perspective&quot; because thats a way I think about tasks - that I&apos;m asking someone to do something for me.</para>
<para>I don&apos;t know how to use the the &apos;Timer&apos; class. And sure, if I throttle at 60 milliseconds, the &apos;Timer&apos; is still starting and stopping every 60 milliseconds just the same.</para>
<para>But the overhead of &quot;asking someone else&quot; to start and stop every 60 milliseconds disappears, in my head. I&apos;m not sure if the overhead I&apos;m imagining actually would disappear but it feels like there would be less &quot;middleman&quot; logic.</para>
<para>In my head it feels as though a &apos;Timer&apos; class is if I were to start and stop every 60 milliseconds. As opposed to asking someone else to do it for me. </para>
</sect1>
    </detaileddescription>
    <inheritancegraph>
      <node id="1">
        <label>Luthetus.TextEditor.RazorLib.BackgroundTasks.Models.ITextEditorWork</label>
        <link refid="interface_luthetus_1_1_text_editor_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_i_text_editor_work"/>
        <childnode refid="2" relation="public-inheritance">
        </childnode>
      </node>
      <node id="2">
        <label>Luthetus.Common.RazorLib.BackgroundTasks.Models.IBackgroundTask</label>
        <link refid="interface_luthetus_1_1_common_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_i_background_task"/>
      </node>
      <node id="3">
        <label>Luthetus.TextEditor.RazorLib.BackgroundTasks.Models.RedundantTextEditorWork</label>
        <link refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_redundant_text_editor_work"/>
        <childnode refid="1" relation="public-inheritance">
        </childnode>
      </node>
      <node id="4">
        <label>Luthetus.TextEditor.RazorLib.BackgroundTasks.Models.UniqueTextEditorWork</label>
        <link refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_unique_text_editor_work"/>
        <childnode refid="1" relation="public-inheritance">
        </childnode>
      </node>
      <node id="5">
        <label>Luthetus.TextEditor.RazorLib.Events.Models.OnDoubleClick</label>
        <link refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_double_click"/>
        <childnode refid="1" relation="public-inheritance">
        </childnode>
      </node>
      <node id="6">
        <label>Luthetus.TextEditor.RazorLib.Events.Models.OnKeyDownLateBatching</label>
        <link refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_key_down_late_batching"/>
        <childnode refid="1" relation="public-inheritance">
        </childnode>
      </node>
      <node id="7">
        <label>Luthetus.TextEditor.RazorLib.Events.Models.OnMouseDown</label>
        <link refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_mouse_down"/>
        <childnode refid="1" relation="public-inheritance">
        </childnode>
      </node>
      <node id="8">
        <label>Luthetus.TextEditor.RazorLib.Events.Models.OnMouseMove</label>
        <link refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_mouse_move"/>
        <childnode refid="1" relation="public-inheritance">
        </childnode>
      </node>
      <node id="9">
        <label>Luthetus.TextEditor.RazorLib.Events.Models.OnScrollHorizontal</label>
        <link refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_scroll_horizontal"/>
        <childnode refid="1" relation="public-inheritance">
        </childnode>
      </node>
      <node id="10">
        <label>Luthetus.TextEditor.RazorLib.Events.Models.OnScrollVertical</label>
        <link refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_scroll_vertical"/>
        <childnode refid="1" relation="public-inheritance">
        </childnode>
      </node>
      <node id="11">
        <label>Luthetus.TextEditor.RazorLib.Events.Models.OnWheel</label>
        <link refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_wheel"/>
        <childnode refid="1" relation="public-inheritance">
        </childnode>
      </node>
      <node id="12">
        <label>Luthetus.TextEditor.RazorLib.Events.Models.OnWheelBatch</label>
        <link refid="struct_luthetus_1_1_text_editor_1_1_razor_lib_1_1_events_1_1_models_1_1_on_wheel_batch"/>
        <childnode refid="1" relation="public-inheritance">
        </childnode>
      </node>
    </inheritancegraph>
    <collaborationgraph>
      <node id="1">
        <label>Luthetus.TextEditor.RazorLib.BackgroundTasks.Models.ITextEditorWork</label>
        <link refid="interface_luthetus_1_1_text_editor_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_i_text_editor_work"/>
        <childnode refid="2" relation="public-inheritance">
        </childnode>
      </node>
      <node id="2">
        <label>Luthetus.Common.RazorLib.BackgroundTasks.Models.IBackgroundTask</label>
        <link refid="interface_luthetus_1_1_common_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_i_background_task"/>
      </node>
    </collaborationgraph>
    <location file="Source/Lib/TextEditor/BackgroundTasks/Models/ITextEditorWork.cs" line="161" column="18" bodyfile="Source/Lib/TextEditor/BackgroundTasks/Models/ITextEditorWork.cs" bodystart="162" bodyend="164"/>
    <listofallmembers>
      <member refid="interface_luthetus_1_1_common_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_i_background_task_1a44fbf9cbedc72ba1587a5021720c015c" prot="public" virt="non-virtual"><scope>Luthetus::TextEditor::RazorLib::BackgroundTasks::Models::ITextEditorWork</scope><name>BackgroundTaskKey</name></member>
      <member refid="interface_luthetus_1_1_common_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_i_background_task_1a1297b3be631c1bb2c38c132674f61911" prot="public" virt="non-virtual"><scope>Luthetus::TextEditor::RazorLib::BackgroundTasks::Models::ITextEditorWork</scope><name>BatchOrDefault</name></member>
      <member refid="interface_luthetus_1_1_text_editor_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_i_text_editor_work_1a4cdd759a4930bd6066a84a86cac60450" prot="public" virt="non-virtual"><scope>Luthetus::TextEditor::RazorLib::BackgroundTasks::Models::ITextEditorWork</scope><name>EditContext</name></member>
      <member refid="interface_luthetus_1_1_common_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_i_background_task_1a21b25df8bfd1ba84e61469ad757b5085" prot="public" virt="non-virtual"><scope>Luthetus::TextEditor::RazorLib::BackgroundTasks::Models::ITextEditorWork</scope><name>HandleEvent</name></member>
      <member refid="interface_luthetus_1_1_common_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_i_background_task_1a0db9af59852fb1de9bbb759e4ec6d96a" prot="public" virt="non-virtual"><scope>Luthetus::TextEditor::RazorLib::BackgroundTasks::Models::ITextEditorWork</scope><name>Name</name></member>
      <member refid="interface_luthetus_1_1_common_1_1_razor_lib_1_1_background_tasks_1_1_models_1_1_i_background_task_1aa2f741e09d6826b4dcbe732fe052790d" prot="public" virt="non-virtual"><scope>Luthetus::TextEditor::RazorLib::BackgroundTasks::Models::ITextEditorWork</scope><name>QueueKey</name></member>
    </listofallmembers>
  </compounddef>
</doxygen>
